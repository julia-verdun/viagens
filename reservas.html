<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Reservas - Carrinho</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f6fc;
      margin: 0;
      padding: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    header {
      font-size: 28px;
      font-weight: bold;
      color: #007bff;
      text-align: center;
      margin-bottom: 30px;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .card-info {
      max-width: 60%;
    }
    .card-info h3 {
      margin: 0 0 8px;
      color: #0056b3;
    }
    .card-info p {
      margin: 0;
      color: #333;
    }
    .btn-remover, .btn-reservar {
      background: #ff4c4c;
      border: none;
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-left: 10px;
    }
    .btn-remover:hover {
      background: #cc0000;
    }
    .btn-reservar {
      background: #28a745;
    }
    .btn-reservar:hover {
      background: #1e7e34;
    }
    .btn-voltar {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin-top: 30px;
      transition: background 0.3s ease;
    }
    .btn-voltar:hover {
      background: #0056b3;
    }
    .vazio {
      text-align: center;
      color: #666;
      font-size: 18px;
      margin-top: 50px;
    }

    /* Card de pagamento */
    #pagamento-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      padding: 20px;
      margin-top: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      display: none;
    }
    #pagamento-card h2 {
      margin-top: 0;
      color: #007bff;
    }
    #pagamento-card label {
      display: block;
      margin: 12px 0 6px;
      font-weight: 600;
      color: #222;
    }
    #pagamento-card select, #pagamento-card input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    #pagamento-card button {
      margin-top: 20px;
      background: linear-gradient(90deg, #007bff, #004a99);
      border: none;
      color: white;
      font-weight: 700;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      width: 100%;
      transition: background 0.3s ease;
    }
    #pagamento-card button:hover {
      background: linear-gradient(90deg, #004a99, #002f66);
    }

    #qrcode-container {
      text-align: center;
      margin-top: 15px;
    }
    #qrcode-container img {
      width: 180px;
      height: 180px;
    }

    /* Mensagem de sucesso */
    #msg-sucesso {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      margin-top: 20px;
      font-weight: 700;
      display: none;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>

<header>üß≥ Seu Carrinho de Reservas</header>

<div id="carrinho-container"></div>

<div id="pagamento-card">
  <h2>Pagamento - Reserve sua viagem</h2>
  <p id="viagem-selecionada" style="font-weight:600; color:#333;"></p>

  <label for="metodo">Escolha a forma de pagamento:</label>
  <select id="metodo" required>
    <option value="" disabled selected>Selecione...</option>
    <option value="pix">PIX</option>
    <option value="cartao">Cart√£o de Cr√©dito</option>
  </select>

  <div id="pix-info" style="display:none;">
    <p>Escaneie o QR Code para pagar com PIX:</p>
    <div id="qrcode-container"></div>
  </div>

  <div id="cartao-info" style="display:none;">
    <label for="numero-cartao">N√∫mero do Cart√£o:</label>
    <input type="text" id="numero-cartao" placeholder="0000 0000 0000 0000" pattern="\d{13,16}" maxlength="16" />

    <label for="validade">Validade (MM/AA):</label>
    <input type="text" id="validade" placeholder="MM/AA" pattern="^(0[1-9]|1[0-2])\/\d{2}$" maxlength="5" />

    <label for="cvv">CVV:</label>
    <input type="text" id="cvv" placeholder="123" pattern="\d{3,4}" maxlength="4" />
  </div>

  <button id="btn-finalizar">Finalizar Reserva</button>
</div>

<div id="msg-sucesso">üéâ Viagem reservada com sucesso! Obrigado por comprar conosco.</div>

<a href="index.html" class="btn-voltar">‚Üê Voltar para Viagens</a>

<script>
  const carrinhoContainer = document.getElementById('carrinho-container');
  const pagamentoCard = document.getElementById('pagamento-card');
  const viagemSelecionadaP = document.getElementById('viagem-selecionada');
  const metodoSelect = document.getElementById('metodo');
  const pixInfo = document.getElementById('pix-info');
  const cartaoInfo = document.getElementById('cartao-info');
  const qrcodeContainer = document.getElementById('qrcode-container');
  const btnFinalizar = document.getElementById('btn-finalizar');
  const msgSucesso = document.getElementById('msg-sucesso');

  let viagemAtivaId = null;
  

  // Fun√ß√£o para gerar um ID simples (usado para identificar destinos no carrinho)
  function gerarId(nome) {
    return nome.toLowerCase().replace(/\s+/g, '-') + '-' + Math.floor(Math.random() * 100000);
  }

  // Fun√ß√£o para pegar par√¢metro da URL
  function getParametroURL(nome) {
    const params = new URLSearchParams(window.location.search);
    return params.get(nome);
  }

  // Adiciona destino do par√¢metro 'destino' da URL ao carrinho (se ainda n√£o estiver)
  function adicionarDestinoDaURL() {
    const destinoNome = getParametroURL('destino');
    if (!destinoNome) return; // Nenhum destino na URL

    let carrinho = JSON.parse(localStorage.getItem('carrinhoReservas')) || [];

    // Verifica se j√° existe no carrinho (usando nome exatamente igual)
    const existe = carrinho.some(item => item.nome.toLowerCase() === destinoNome.toLowerCase());
    if (existe) return; // J√° est√° no carrinho, n√£o adiciona

    // Como voc√™ n√£o envia descri√ß√£o/resumo nem imagem pela URL, vamos colocar um resumo gen√©rico.
    const novoItem = {
      id: gerarId(destinoNome),
      nome: destinoNome,
      resumo: 'Descri√ß√£o n√£o dispon√≠vel, finalize a reserva para detalhes.',
    };

    carrinho.push(novoItem);
    localStorage.setItem('carrinhoReservas', JSON.stringify(carrinho));
  }

  // Renderiza o carrinho
  function renderCarrinho() {
    const carrinho = JSON.parse(localStorage.getItem('carrinhoReservas')) || [];
    carrinhoContainer.innerHTML = '';

    if (carrinho.length === 0) {
      carrinhoContainer.innerHTML = '<p class="vazio">Seu carrinho est√° vazio.</p>';
      pagamentoCard.style.display = 'none';
      msgSucesso.style.display = 'none';
      return;
    }

    carrinho.forEach(item => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-info">
          <h3>${item.nome}</h3>
          <p>${item.resumo}</p>
        </div>
        <div>
          <button class="btn-reservar" data-id="${item.id}">Reservar</button>
          <button class="btn-remover" data-id="${item.id}">Remover</button>
        </div>
      `;
      carrinhoContainer.appendChild(card);
    });
  }

  // Remove item do carrinho
  carrinhoContainer.addEventListener('click', e => {
    if (e.target.classList.contains('btn-remover')) {
      const id = e.target.getAttribute('data-id');
      let carrinho = JSON.parse(localStorage.getItem('carrinhoReservas')) || [];
      carrinho = carrinho.filter(v => v.id !== id);
      localStorage.setItem('carrinhoReservas', JSON.stringify(carrinho));
      renderCarrinho();
      pagamentoCard.style.display = 'none';
      msgSucesso.style.display = 'none';
    } else if (e.target.classList.contains('btn-reservar')) {
      const id = e.target.getAttribute('data-id');
      mostrarPagamento(id);
    }
  });

  // Exibe card de pagamento
  function mostrarPagamento(id) {
    const carrinho = JSON.parse(localStorage.getItem('carrinhoReservas')) || [];
    const viagem = carrinho.find(v => v.id === id);
    if (!viagem) return;

    viagemAtivaId = id;
    viagemSelecionadaP.textContent = `${viagem.nome} - ${viagem.resumo}`;
    pagamentoCard.style.display = 'block';

    // Reset formul√°rio
    metodoSelect.value = '';
    pixInfo.style.display = 'none';
    cartaoInfo.style.display = 'none';
    qrcodeContainer.innerHTML = '';
    msgSucesso.style.display = 'none';

    // Limpar inputs cart√£o
    document.getElementById('numero-cartao').value = '';
    document.getElementById('validade').value = '';
    document.getElementById('cvv').value = '';
  }

  // Ao mudar m√©todo de pagamento
  metodoSelect.addEventListener('change', () => {
    const metodo = metodoSelect.value;
    if (metodo === 'pix') {
      pixInfo.style.display = 'block';
      cartaoInfo.style.display = 'none';
      gerarQRCodeAleatorio();
    } else if (metodo === 'cartao') {
      pixInfo.style.display = 'none';
      cartaoInfo.style.display = 'block';
      qrcodeContainer.innerHTML = '';
    } else {
      pixInfo.style.display = 'none';
      cartaoInfo.style.display = 'none';
      qrcodeContainer.innerHTML = '';
    }
  });

  // Gera um QR code aleat√≥rio (imagem dummy)
  function gerarQRCodeAleatorio() {
    // URLs aleat√≥rias de QR codes gr√°tis (placeholder)
    const imagens = [
      'https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=PagamentoPIX1',
      'https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=PagamentoPIX2',
      'https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=PagamentoPIX3',
      'https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=PagamentoPIX4',
      'https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=PagamentoPIX5',
    ];
    const index = Math.floor(Math.random() * imagens.length);
    qrcodeContainer.innerHTML = `<img src="${imagens[index]}" alt="QR Code PIX" />`;
  }

  // Finalizar compra
  btnFinalizar.addEventListener('click', () => {
    if (!viagemAtivaId) {
      alert('Selecione uma viagem para reservar!');
      return;
    }
    const metodo = metodoSelect.value;
    if (!metodo) {
      alert('Escolha a forma de pagamento!');
      return;
    }

    if (metodo === 'cartao') {
      // Valida dados cart√£o
      const num = document.getElementById('numero-cartao').value.trim();
      const validade = document.getElementById('validade').value.trim();
      const cvv = document.getElementById('cvv').value.trim();

      if (!/^\d{13,16}$/.test(num.replace(/\s/g, ''))) {
        alert('N√∫mero do cart√£o inv√°lido!');
        return;
      }
      if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(validade)) {
        alert('Validade inv√°lida! Use MM/AA');
        return;
      }
      if (!/^\d{3,4}$/.test(cvv)) {
        alert('CVV inv√°lido!');
        return;
      }
    }

    // Simula sucesso do pagamento
    let carrinho = JSON.parse(localStorage.getItem('carrinhoReservas')) || [];
    carrinho = carrinho.filter(v => v.id !== viagemAtivaId);
    localStorage.setItem('carrinhoReservas', JSON.stringify(carrinho));
    renderCarrinho();
    pagamentoCard.style.display = 'none';
    msgSucesso.style.display = 'block';
    viagemAtivaId = null;
  });

  // Inicializa√ß√£o
  adicionarDestinoDaURL();
  renderCarrinho();
</script>

</body>
</html>